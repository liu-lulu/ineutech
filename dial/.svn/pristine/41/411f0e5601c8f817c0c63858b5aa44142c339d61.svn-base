[TOC]

# 数据类型

数据类型 	|描述及要求
------------|--------------
BYTE		|无符号单字节整形（字节， 8 位）
WORD		|无符号双字节整形（字， 16 位）
DWORD		|无符号四字节整形（双字， 32 位）
BYTE[n] 	| n 字节
BCD[n] 		|8421 码， n 字节
STRING 		|GBK 编码，若无数据，置空


# 消息结构


标识位		|消息头		|消息体		|校验码	 	|标识位
------------|-----------|-----------|-----------|------
1byte(0x7e)	|16byte		|			|1byte		|1byte(0x7e)


## 标识位

```
标识位		消息头		消息体		校验码		标识位

标识位
转义处理过程如下：
	发送消息时：消息封装 ——> 计算并填充校验码 ——> 转义
	接收消息时：转义还原 ——> 验证校验码 ——> 解析消息

	0x7e <————> 0x7d 后紧跟一个 0x02
	0x7d <————> 0x7d 后紧跟一个 0x01
```

## 消息头

```
消息ID(0-1)	消息体属性(2-3)	终端手机号(4-9)	消息流水号(10-11)	消息包封装项(12-15)

byte[0-1] 	消息ID word(16)
byte[2-3] 	消息体属性 word(16)
		bit[0-9]	消息体长度
		bit[10-12]	数据加密方式
						此三位都为 0，表示消息体不加密
						第 10 位为 1，表示消息体经过 RSA 算法加密
						其它保留
		bit[13]		分包
						1：消息体卫长消息，进行分包发送处理，具体分包信息由消息包封装项决定
						0：则消息头中无消息包封装项字段
		bit[14-15]	保留
byte[4-9] 	终端手机号或设备ID bcd[6]
		根据安装后终端自身的手机号转换
		手机号不足12 位，则在前面补 0
byte[10-11] 	消息流水号 word(16)
		按发送顺序从 0 开始循环累加
byte[12-15] 	消息包封装项
		byte[0-1]	消息包总数(word(16))
						该消息分包后得总包数
		byte[2-3]	包序号(word(16))
						从 1 开始
		如果消息体属性中相关标识位确定消息分包处理,则该项有内容
		否则无该项
```


## 校验码

校验码指从消息头开始，同后一字节异或，直到校验码前一字节(```消息头+消息体```)，占用一个字节。

# 消息体

## 终端通用应答

- 消息 ID:0x0001

```
应答流水号(WORD) + 应答ID(WORD ) + 结果(BYTE )

byte[0-1] 	应答流水号
				对应的平台消息的流水号
byte[2-3] 	应答ID
				对应的平台消息的ID
byte[4] 	结果
				0：成功∕确认
				1：失败
				2：消息有误
				3：不支持
```

## 终端心跳 ==> 平台通用应答

- 消息 ID: 0x0002

终端心跳数据消息体为空。

## 终端注册 ==> 终端注册应答

- 消息 ID: 0x0100

```
byte[0-1] 	省域ID(WORD)
				设备安装车辆所在的省域，省域ID采用GB/T2260中规定的行政区划代码6位中前两位
				0保留，由平台取默认值
byte[2-3] 	市县域ID(WORD)
				设备安装车辆所在的市域或县域,市县域ID采用GB/T2260中规定的行
					政区划代码6位中后四位
				0保留，由平台取默认值
byte[4-8] 	制造商ID(BYTE[5])
				5 个字节，终端制造商编码
byte[9-16] 	终端型号(BYTE[8])
				八个字节， 此终端型号 由制造商自行定义
				位数不足八位的，补空格。
byte[17-23] 终端ID(BYTE[7])
				七个字节， 由大写字母 和数字组成， 此终端 ID由制造 商自行定义
byte[24] 	车牌颜色(BYTE)
				车牌颜 色按照JT/T415-2006 中5.4.12 的规定
byte[25-x] 	车牌(STRING)
				公安交 通管理部门颁 发的机动车号牌
```

## 终端注销 ==> 平台通用应答

- 消息 ID: 0x0003

终端注销数据消息体为空。


## 终端鉴权 ==> 平台通用应答

- 消息 ID: 0x0102

```
byte[0-x] 	鉴权码(STRING)
				终端重连后上报鉴权码
```

## 位置信息汇报 ==> 平台通用应答

- 消息 ID:0x0200

状态发生改变需立即上报位置信息

```
byte[0-3] 	报警标志(DWORD(32))
				bit[0]
				bit[1]
				bit[2]
				.....
				bit[31]
byte[4-7] 	状态(DWORD(32))
				bit[0] 		0：ACC 关； 1： ACC 开
				bit[1] 		0：未定位； 1：定位
				bit[2] 		0：北纬； 1：南纬
				bit[3] 		0：东经； 1：西经
				bit[4] 		0:运营状态;1:停运状态
				bit[5] 		0：经纬度未经保密插件加密； 1：经纬度已经保密插件加密
				bit[6-9] 	保留
				bit[10] 	0:车辆油路正常;1:车辆油路断开
				bit[11] 	0:车辆电路正常;1:车辆电路断开
				bit[12] 	0:车门解锁;1:车门加锁
				bit[13-31] 	保留
byte[8-11] 	纬度(DWORD(32))
				以度为单位的纬度值乘以10^6，精确到百万分之一度
byte[12-15] 经度(DWORD(32))
				以度为单位的经度值乘以10^6，精确到百万分之一度
byte[16-17]	高程(WORD(16))
				海拔高度，单位为米（ m）
byte[18-19]	速度(WORD)
				1/10km/h
byte[20-21] 方向(WORD)
				0-359，正北为 0，顺时针
byte[22-x] 	时间(BCD[6])
				YY-MM-DD-hh-mm-ss
				GMT+8 时间，本标准中之后涉及的时间均采用此时区
```


## 胎温胎压信息汇报 ==> 平台通用应答

- 消息 ID:0x0600


```
byte[0] 	轮胎位置(BCD[1])
				定义为，0xAB，A代表轴信息，B代表该轴的第几个胎
				轴顺序为从前到后，轮胎顺序为从左到右
byte[1] 	胎压(Byte)
				1/10 公斤
byte[2-3] 	胎温(Word)
				(N-27300)/100 度
byte[4] 	状态(Byte)
				bit[0] 0：关，1;开(传感器)
				bit[1-7] 保留
byte[5-6] 	保留(Word(16))
byte[7] 	压力阀测试(Byte)
				bit[0] 0：正常，1;超压报警
					标志维持至报警条件解除
				bit[1] 0：正常；1:低压报警 
					标志维持至报警条件解除
				bit[2] 0：正常;1:超低压报警
					标志维持至报警条件解除
				bit[3] 0：正常；1：错误和信号丢失报警
					标志维持至报警条件解除
				bit[4] 0：正常；1：传感器自检中
					标志维持至报警条件解除
				bit[5] 0：正常；1:高温报警
					标志维持至报警条件解除
				bit[6] 0：正常；1:电池欠压
					标志维持至报警条件解除
				bit[7] 保留
byte[8-13] 	时间(BCD[6])
				YY-MM-DD-hh-mm-ss
byte[14-25] 轮胎胎号(BYTE[12])
byte[26-27] 电压(Word)
				1/10V
byte[28-39] 传感器编号(BYTE[12])
```



## 平台通用应答

- 消息 ID: 0x8001

```
应答流水号(WORD) + 应答ID(WORD ) + 结果(BYTE )

byte[0-1] 	应答流水号
				对应的终端消息的流水号
byte[2-3] 	应答ID
				对应的终端消息的ID
byte[4] 	结果
				0：成功∕确认
				1：失败
				2：消息有误
				3：不支持
				4：报警处理确认
```

## 终端注册应答

- 消息 ID:0x8100


```
byte[0-1] 	应答流水号(WORD)
				对应的终端注册消息的流水号
byte[2] 	结果(BYTE)
				0：成功
				1：车辆已被注册
				2：数据库中无该车辆
byte[3-x] 	鉴权码(STRING)
				只有在成功后才有该字段
```


## 管理类
### 设置终端参数

- 消息 ID:0X8103

```
byte[0] 	参数总数(BYTE)
byte[1-x] 	参数列表
```

### 查询终端参数
### 查询终端参数应答
